<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jbb.mgt.core.dao.mapper.UserLibraryMapper">
	<select id="getUserLibraryInfo" resultType="com.jbb.mgt.core.domain.UserLibraryInfo">
		SELECT
		u.user_id AS userId,
		u.phone_number AS phoneNumber,
		u.first_channel_code AS channelCode,
		c.channel_name AS channelName,
		u.creation_date AS creationDate,
		u.ip_address_first AS ipAddress
		FROM
		mgt_users u
		LEFT JOIN mgt_channels c ON c.channel_code = u.first_channel_code
		WHERE
	     u.creation_date <![CDATA[>=]]> #{startDate}
		<if test="phoneNumber!=null">AND  u.phone_number LIKE CONCAT('%',#{phoneNumber},'%')</if>
		<if test="channelCode!=null">AND  u.first_channel_code =#{channelCode} </if>
		<if test="ipAddress!=null">AND  u.ip_address_first =#{ipAddress}</if>
		<if test="endDate!=null">AND  u.creation_date <![CDATA[<]]> #{endDate} </if>
		ORDER BY
		u.creation_date DESC
	</select>

</mapper> 
